<!doctype html>
<html lang="en" data-bs-theme="dark" class="spaceBG">
  <head>
        <!-- these meta tags cannot be nested in a module, so they're out here -->
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Bucket v2.5</title>
        
        <link rel="stylesheet" href="css/bootstrap.min.css">
        <link rel="stylesheet" href="css/custom.css">
        <link rel="preload" href="css/backdroponly.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    </head>
    <body>
        <div class="container-fluid z-n1 position-absolute">
            <div class="container">
              <pagelogo>
                  <div class="container">
                    <div class="">
                        <p class="text-center mb-n"><span class="runguszone siteText">Bucket</p>
                        <p class="text-center fs-5"><span class="badge bg-primary-subtle">version 2.5</span></p>
                    </div>
                </div>
              </pagelogo>
              <helloarea>
                <div class="container alert frostedglass">
                    <div id="botInfo">
                        <p class="runguszone text-center fs-3 lead">
                            Total Pings: <span class="badge bg-info-subtle"><span id="totalPings">0</span></span> 
                            <br>Blocked Words: <span id="blockedWordsCount"><span class="badge bg-success">0</span></span>
                            <br>Messages Saved: <span class="badge bg-success"><span id="trainingDataFromMessage">0</span></span></p>
                        <hr>
                        <p class="text-center fs-4 lead">
                            Connected As: <span class="badge bg-secondary-subtle"><span id="botTag"><span class="spinner-border spinner-border-sm" role="status"></span></span></span>
                            <br>
                            Bot State: <span class="badge bg-primary"><span id="botState"><span class="spinner-border spinner-border-sm" role="status"></span></span></span>
                        </p>
                    </div>
                </div>
              </helloarea>
                <div class="container alert frostedglass">
                    <p class="lead text-center runguszone fs-3">Recent Messages:</p>
                    <div id="messagesContainer"></div>
                </div>
                


        <script>
            const { ipcRenderer } = require('electron');

            ipcRenderer.on('bot-update', (event, data) => {
                document.getElementById('totalPings').textContent = data.totalPings;
                if (data.blockedWordsCount > 0) {
                    document.getElementById('blockedWordsCount').innerHTML = `<span class="badge bg-danger">${data.blockedWordsCount}</span>`;
                }
                document.getElementById('trainingDataFromMessage').textContent = data.trainingDataFromMessage;
                document.getElementById('botTag').innerHTML = data.botTag;
                document.getElementById('botState').innerHTML = data.botState;
            });

            ipcRenderer.on('recent-messages-update', (event, messages) => {
                const messagesContainer = document.getElementById('messagesContainer');
                messagesContainer.innerHTML = ''; // Clear existing messages
                messages.forEach(message => {
                    const messageDiv = document.createElement('div');
                    messageDiv.className = 'container alert frostedglass'; // Apply CSS class for styling

                    // Constructing the message content
                    messageDiv.innerHTML = `
                        <p>${message.sender}: ${message.originalMessage}</p>
                        <p>Pre-Filter: ${message.preFilteredMessage}</p>
                        <p>Filtered: ${message.filteredMessage}</p>
                        <span class="badge bg-dark-subtle">Tokens: I-${message.inputTokensUsed} O-${message.outputTokensUsed} T-${message.totalTokensUsed}</span>
                    `;

                    // Insert the new message at the beginning of the container
                    if (messagesContainer.firstChild) {
                        messagesContainer.insertBefore(messageDiv, messagesContainer.firstChild);
                    } else {
                        messagesContainer.appendChild(messageDiv); // Use appendChild if the container is empty
                    }
                });
            });
        </script>

    </body>
</html>
